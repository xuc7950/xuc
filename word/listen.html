<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta content="user-scalable=0" name="viewport" />
    <title>听写</title>
    <style media="screen">
      body{
        background:url('images/bg1.jpg');
        font-size:3em;
      }
      #content{
        width:950px;
        height:1400px;
        background:rgba(255,255,255,0.2);
        margin-top:10px;
        padding:10px;
      }
      table{
        width:100%;
        margin-top:30px;
      }
      #answer{
        width:95%;
        height:120px;
        font-size:1.5em;
        border-radius:10px;
      }
      .btn{
        width:90%;
        height:100px;
        font-size:1.5em;
        margin-top:30px;
        margin-bottom:30px;
        background:url('https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=2731016704,2462198237&fm=200&gp=0.jpg');
        color:white;
        border-radius:10px;
      }
      .voice{
        font-size:1em;
        background: none;
        color:yellow;
        border-top: none;
      }
    </style>
	  <script src="http://libs.baidu.com/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript">
      if(localStorage['words'] != undefined){
        var words = JSON.parse(localStorage['words']);
      }else{
        alert("您未导入词汇，即将跳转至导入单词界面...");
        location.href='add.html';
      }
      var n = 0;  //done
      var url1 = "http://tsn.baidu.com/text2audio?tex=";
      var url2 = "&lan=zh&cuid=123&ctp=1&tok=25.4fe227926ad479b1f1774bfea1b13f48.315360000.1861350595.282335-15297333&per=";
      var per = 0;  //0、1、2、3、4
      var words = JSON.parse(localStorage['words']);  //data
      var n = parseInt(Math.random()*words.length);
      $(function(){
        $('#question')[0].innerHTML = words[n].translate;
      });

      function change(){
        //cn
        $('#cn').toggle(500,function(){
        if ($('#cn')[0].src.match('play_btn.png')){
          $('#cn')[0].src='images/play_btn1.png';
        }else{
          $('#cn')[0].src='images/play_btn.png';
        }
        });
        $('#cn').toggle(500);

        //en
        $('#en').toggle(500,function(){
        if ($('#en')[0].src.match('play_btn.png')){
          $('#en')[0].src='images/play_btn1.png';
        }else{
          $('#en')[0].src='images/play_btn.png';
        }
        });
        $('#en').toggle(500);
      }

      function next(){
        //check
        if ($('#answer').val()=='') return false; //判断是否输入
       if ($('#answer').val() != words[n].word){  //false
         var temp = [];
         for (var i=0;i<$('#answer').val().length;i++){
           if (words[n].word[i] == $('#answer').val()[i]){
             temp[i] = words[n].word[i];
           }else{
                temp[i] = $('#answer').val()[i].fontcolor('red');

           }
         }

         //show error
         for (var i=0;i<temp.length;i++){
           document.getElementById('show').innerHTML += temp[i];
         }



         setTimeout(function(){
           $('#answer').val('');
           $('#answer')[0].placeholder = words[n].word;
           document.getElementById('show').innerHTML = "";
         },2000);

       }else{   //true
          //replace
          $('#answer')[0].placeholder = '';
          $('#answer').val('');
          n = parseInt(Math.random()*words.length);
          while(words[n].translate == $('#question')[0].innerHTML){
            n = parseInt(Math.random()*words.length);
          }
          $('#question')[0].innerHTML = words[n].translate;
          done++;
        }
        play_cn($('#cn')[0]);
        $("#done")[0].innerHTML = done;
      }


      function play_cn(pl){
        var text = words[n].translate;
        document.getElementById("playing").src=url1+text+url2+per;
        document.getElementById("playing").play();
        pl.style.opacity = 0.8;
        window.setTimeout(function(){
          pl.style.opacity = 1;
        },1000);
      }


      function play_en(pl){
        var text = words[n].word;
        document.getElementById("playing").src=url1+text+url2+per;
        document.getElementById("playing").play();
        pl.style.opacity = 0.8;
        window.setTimeout(function(){
          pl.style.opacity = 1;
        },1000);
      }

      function playing(pl){
        if (pl.src.match('play_btn.png')){
          play_cn(pl);
        }else{
          play_en(pl);
        }
          // if ($('#en')[0].src == pl.src){
          //   $('#en')[0].style.opacity = 0.8;
          //   window.setTimeout(function(){
          //     $('#en')[0].style.opacity = 1;
          //   },1000);
          // }else{
          //   $('#cn')[0].style.opacity = 0.8;
          //   window.setTimeout(function(){
          //     $('#cn')[0].style.opacity = 1;
          //   },1000);
          // }
      }

      function voice(){
        if (per == 2){
          per = 0;
          $('#voice').val('女  音');
        }else{
          per = 2;
          $('#voice').val('男  音');
        }
      }


      function all_word(){
        var len = words.length;
        var w_all = "<h3>所有单词</h3>";
        for (var i=0;i<len;i++){
          w_all += "<li>"+words[i].word+":"+words[i].translate+"</li>";
        }
        document.getElementById('all_word').innerHTML = (w_all.fontsize('13em'));
        $("#all_word").toggle(1000);
      }
    </script>
  </head>
  <body>
    <audio id='playing' autoplay src="http://tsn.baidu.com/text2audio?tex=%e5%90%ac%e5%86%99%e5%8d%b3%e5%b0%86%e5%bc%80%e5%a7%8b%ef%bc%8c%e8%af%b7%e5%81%9a%e5%a5%bd%e5%87%86%e5%a4%87&lan=zh&cuid=123&ctp=1&tok=25.4fe227926ad479b1f1774bfea1b13f48.315360000.1861350595.282335-15297333"></audio>
    <div id="content" align="center">
    <div id="all_word"></div>
      <div style="font-size:0.8em;">
        <br/>
        <a href="word.html" style="float:right;text-decoration:none;">
          <input id="change" type="button" value="记单词➾" style="font-size:1.3em;border-radius:20px;opacity:0.5;"/>
        </a>
        <a onclick="location.href='add.html'" style="float:right;text-decoration:none;">
          <input type="button" value="添加单词" style="color:gray;background:none;font-size:1.3em;border-radius:20px;opacity:0.5;"/>
        </a>
        <a onclick="all_word()" style="float:right;text-decoration:none;">
          <input type="button" value="查看所有单词" style="color:gray;background:none;font-size:1.3em;border-radius:20px;opacity:0.5;"/>
        </a>
        <a>
          <input type="button" id="voice" class="voice" onclick="voice()" value="女  音">
        </a>
      </div>
      <table border="5" onkeypress="if(window.event.keyCode==13) next();">
        <tbody style="display:none">
          <tr>
            <th colspan="3">
              <h1 id='question' style="color:white;">翻译</h1>
            </th>
          </tr>
        </tbody>
        <tbody>
          <tr>
            <th colspan="3">
            <p style="color:white;">已背<a id='done' style="color:yellow">0</a>个单词</p>
            </th>
          </tr>
        </tbody>
        <tbody>
          <tr align="center">
            <td>
              <img id="cn" onclick="playing(this)" src="images/play_btn.png" width="80%" alt="读中文">
            </td>
            <td onclick="change()">
              <a style="color:white;font-size:2em;">⇄</a>
            </td>
            <td>
              <img id="en" onclick="playing(this)" src="images/play_btn1.png" width="40%" alt="读英文">
            </td>
          </tr>
        </tbody>
        <tbody>
          <tr>
            <th colspan="3">
              <p id="show" style="color:white;"></p>
            </th>
          </tr>
        </tbody>
          <tbody>
            <tr>
              <th colspan="3">
                <input id="answer" placeholder="在这里输入您的答案" type="text">
              </th>
            </tr>
          </tbody>
          <tbody>
            <tr align="center">
              <th colspan="2">
                <input class="btn" onclick="next()" type="button"  value="确定">
              </th>
              <td>
                <input class="btn" type="reset">
              </td>
            </tr>
          </tbody>
      </table>
      <p align="center" style="margin-top:350px;color:gray;font-size:0.8em;">Copyright&copy;XuChao 2018-01-26 all right reserved<br/> http://39.108.213.4/index.asp
        <a href="mailto:xuc7950@foxmail.com"><input type="button" value="Contact us" style="font-size:1em;background:none;color:gray;"></a>
        <a href="http://39.108.213.4/index.asp"><input type="button" value="Opinion" style="font-size:1em;background:none;color:gray;"></a>
      </p>
    </div>
  </body>
</html>
